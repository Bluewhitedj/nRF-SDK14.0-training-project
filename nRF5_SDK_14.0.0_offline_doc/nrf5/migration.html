<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>nRF5 SDK v14.0.0: Migration guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra_stylesheet_offline.css" rel="stylesheet" type="text/css"/>
<link href="nordic.css" rel="stylesheet" type="text/css" />
<link rel="Shortcut icon" href="./favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" width="100%" class="blank">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Nordic Semiconductor" src="nordic_small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">nRF5 SDK
   &#160;<span id="projectnumber">v14.0.0</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<table cellspacing="0" cellpadding="0" class="blank">
<tr>
<td class="doclinkintro">Choose documentation:</td>
<td class="doclinks" id="nrf5"><a href="../nrf5/index.html">nRF5 SDK</a></td>
<td class="doclinks" id="s132"><a href="../s132/index.html">S132 SoftDevice API</a></td>
<td class="doclinks" id="s140"><a href="../s140/index.html">S140 SoftDevice API</a></td>
<td class="doclinks" id="s212"><a href="../s212/index.html">S212 SoftDevice API</a></td>
<!--<td class="doclinks" id="s332"><a href="../s332/index.html">S332 SoftDevice API</a></td>-->
</tr>
</table>
<script>
var url=window.location.href.split("/").reverse()[1];
var validLinks= ["nrf5","s132","s140","s212","s332"];
var index;
for (index = 0; index < validLinks.length; ++index) {
   if ( url.indexOf(validLinks[index]) !== -1 ) {
      document.getElementById(validLinks[index]).setAttribute('class', 'doclinks docselected');
   };
};
</script>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('migration.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Migration guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#migration_ble">Bluetooth low energy (BLE)</a><ul><li class="level2"><a href="#migration_ble_sdhandler">SoftDevice handler</a></li>
<li class="level2"><a href="#migration_ble_adv_mod">Advertising Module (ble_advertising)</a></li>
<li class="level2"><a href="#migration_ble_adv_init">ble_advertising_init</a></li>
<li class="level2"><a href="#migration_ble_adv_enc">Advertising Encoder (ble_advdata)</a></li>
<li class="level2"><a href="#migration_ble_conn_params">Connection Parameters Module (ble_conn_params)</a></li>
</ul>
</li>
<li class="level1"><a href="#migration_fds">Flash Data Storage (FDS)</a><ul><li class="level2"><a href="#migration_fds_chunks">FDS record chunks removed</a></li>
<li class="level2"><a href="#migration_fds_header">fds_header_t</a></li>
<li class="level2"><a href="#migration_fds_config">CRC configuration options</a></li>
</ul>
</li>
<li class="level1"><a href="#migration_fstorage">fstorage</a></li>
<li class="level1"><a href="#migration_ble_config">Configuration of the BLE stack</a></li>
<li class="level1"><a href="#migration_libs">Libraries</a><ul><li class="level2"><a href="#migration_libs_nrf_cli">nrf_cli</a></li>
<li class="level2"><a href="#migration_libs_nrf_log">nrf_log</a></li>
<li class="level2"><a href="#migration_libs_nrf_pwr_mgmt">nrf_pwr_mgmt</a></li>
<li class="level2"><a href="#migration_libs_atomic_fifo">Atomic FIFO</a></li>
</ul>
</li>
<li class="level1"><a href="#migration_nfc">NFC</a><ul><li class="level2"><a href="#migration_nfc_ndef_record">NDEF record and message descriptors</a></li>
<li class="level2"><a href="#migration_nfc_pairing_lib">NFC BLE pairing library</a></li>
</ul>
</li>
<li class="level1"><a href="#migration_dfu">DFU</a><ul><li class="level2"><a href="#migration_dfu_timer">Inactivity timeout timer</a></li>
<li class="level2"><a href="#migration_dfu_api">DFU API changes</a></li>
</ul>
</li>
<li class="level1"><a href="#migration_usb">USB</a><ul><li class="level2"><a href="#migration_usb_events">USBD START and STOP events renamed</a></li>
<li class="level2"><a href="#migration_usb_main_loop">Processing of high level events in the main loop</a></li>
<li class="level2"><a href="#migration_usb_audio">USB audio class API rebuilt</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>If you built an application based on nRF5 SDK v13.0.0, complete the actions listed in the following sections to migrate your application to nRF5 SDK v14.0.0.</p>
<p>Note that this migration guide does not list all changes, but it covers the most important changes that require you to update your code. See the <a class="el" href="index.html">release notes</a> for further information on changes that were made in this release.</p>
<h1><a class="anchor" id="migration_ble"></a>
Bluetooth low energy (BLE)</h1>
<h2><a class="anchor" id="migration_ble_sdhandler"></a>
SoftDevice handler</h2>
<p>The SoftDevice handler library has been reworked. The name of the library has changed from <code>softdevice_handler</code> to <code>nrf_sdh</code> and most of the API has changed accordingly.</p>
<p>The most commonly used functions have changed in the following way:</p>
<table class="doxtable">
<tr>
<th>Old API </th><th>New API</th></tr>
<tr>
<td>SOFTDEVICE_HANDLER_INIT </td><td><a class="el" href="group__nrf__sdh.html#ga574d17fdf1c59dec6355e3f525c484ec">nrf_sdh_enable_request()</a> </td></tr>
<tr>
<td>softdevice_handler_sd_disable() </td><td><a class="el" href="group__nrf__sdh.html#ga38fb7087993c1e6eae22c0e00725640e">nrf_sdh_disable_request()</a> </td></tr>
<tr>
<td>softdevice_enable(uint32_t * ram_start) </td><td><a class="el" href="group__nrf__sdh__ble.html#ga12ef367fb1a6d329e3129a054209ee2d">nrf_sdh_ble_enable(uint32_t * ram_start)</a> </td></tr>
<tr>
<td>softdevice_app_ram_start_get(uint32_t * ram_start) </td><td><a class="el" href="group__nrf__sdh__ble.html#gabd0c941014d63bc4ac9814a871bd7a4c">nrf_sdh_ble_app_ram_start_get(uint32_t * ram_start)</a> </td></tr>
<tr>
<td>N/A </td><td><a class="el" href="group__nrf__sdh__ble.html#ga20d99b6d73ca06cb2078d140f9b380c1">nrf_sdh_ble_default_cfg_set(uint8_t conn_cfg_tag, uint32_t * p_ram_start)</a> </td></tr>
</table>
<p>In all BLE examples, the <code>ble_stack_init</code> function was updated to reflect the required changes.</p>
<p><em><b>Action:</b> Search and replace the occurences.</em></p>
<p>The stack configuration parameters are now part of the SoftDevice handler module configuration: <a class="el" href="group__nrf__sdh__ble__config.html">SoftDevice BLE event handler configuration</a> for BLE and <a class="el" href="group__nrf__sdh__ant__config.html">SoftDevice ANT event handler configuration</a> for ANT.</p>
<p>A new API call (<a class="el" href="group__nrf__sdh__ble.html#ga20d99b6d73ca06cb2078d140f9b380c1">nrf_sdh_ble_default_cfg_set</a>) has been introduced to set up the stack with the configuration set in <code>sdk_config</code>. In all BLE examples, the <code>ble_stack_init</code> function was updated to reflect the required changes.</p>
<p>There are two schemes to configure the BLE stack: </p>
<div class="fragment"><div class="line"><a class="code" href="group__nrf__sdh.html#ga574d17fdf1c59dec6355e3f525c484ec" title="Function for requesting to enable the SoftDevice.">nrf_sdh_enable_request</a>();                   <span class="comment">/* Enable the SoftDevice. */</span></div>
<div class="line">uint32_t ram_start;</div>
<div class="line"><a class="code" href="group__nrf__sdh__ble.html#gabd0c941014d63bc4ac9814a871bd7a4c" title="Function for retrieving the address of the start of application&#39;s RAM.">nrf_sdh_ble_app_ram_start_get</a>(&amp;ram_start);</div>
<div class="line"><span class="comment">/* Configure the stack using the SoftDevice API (@ref sd_ble_cfg_set). */</span></div>
<div class="line">nrf_sdh_ble_enabled(&amp;ram_start);            <span class="comment">/* Enable the BLE stack. */</span></div>
</div><!-- fragment --><p>Alternatively: </p>
<div class="fragment"><div class="line"><a class="code" href="group__nrf__sdh.html#ga574d17fdf1c59dec6355e3f525c484ec" title="Function for requesting to enable the SoftDevice.">nrf_sdh_enable_request</a>();                               <span class="comment">/* Enable the SoftDevice. */</span></div>
<div class="line">uint32_t <span class="keyword">const</span> conn_cfg_tag = 1;                        <span class="comment">/* A tag that identifies the BLE stack configuration. */</span></div>
<div class="line">uint32_t ram_start;</div>
<div class="line"><a class="code" href="group__nrf__sdh__ble.html#ga20d99b6d73ca06cb2078d140f9b380c1" title="Set the default BLE stack configuration.">nrf_sdh_ble_default_cfg_set</a>(conn_cfg_tag, &amp;ram_start);  <span class="comment">/* Configure the BLE stack with the settings specified in sdk_config. */</span></div>
<div class="line"><span class="comment">/* Optionally, configure any additional parameters using the SoftDevice API. */</span></div>
<div class="line"><a class="code" href="group__nrf__sdh__ble.html#ga12ef367fb1a6d329e3129a054209ee2d" title="Function for configuring and enabling the BLE stack.">nrf_sdh_ble_enable</a>(&amp;ram_start);                         <span class="comment">/* Enable the BLE stack. */</span></div>
</div><!-- fragment --><p><em><b>Action:</b> Update the stack configuration parameters in sdk_config.h as necessary, and update your stack initialization code.</em></p>
<p>The scheme for dispatching events from the SoftDevice to the libraries and services has changed: the <code>ble_evt_dispatch</code> and <code>sys_evt_dispatch</code> functions have been removed, in favor of registering BLE and SoC event observers using the <a class="el" href="group__nrf__sdh__ble.html#gad162c1f4d4c248e4d4567dfa70e0e10e">NRF_SDH_BLE_OBSERVER</a> and <a class="el" href="group__nrf__sdh__soc.html#ga61b74435c52e1527c8802d0e4b2436bb">NRF_SDH_SOC_OBSERVER</a> macros, respectively.</p>
<p>The following is an example of how an application previously used the <code>ble_evt_dispatch</code> function, dispatching BLE events to the HRS service and the application BLE event handler: </p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> ble_evt_dispatch(<a class="codeRef" doxygen="tag_s140_offline.tag:../s140/" href="../s140/structble__evt__t.html">ble_evt_t</a> * p_ble_evt)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__ble__hrs.html#ga5d86b39ae7f40223fcb7caaf3978bf70" title="Function for handling the Application&#39;s BLE Stack events.">ble_hrs_on_ble_evt</a>(&amp;m_hrs, p_ble_evt);</div>
<div class="line">    on_ble_evt(p_ble_evt);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Using the new SoftDevice handler implementation, the service and the application receive BLE events automatically by registering themselves as BLE stack event observers, as shown below: </p>
<div class="fragment"><div class="line"><span class="comment">/* The following macro defines a Heart Rate service instance and registers it</span></div>
<div class="line"><span class="comment">   to listen to relevant events coming from the SoftDevice. */</span></div>
<div class="line"><a class="code" href="group__ble__hrs.html#gaf6235ff2e252bebdbf97e847d82f399d" title="Macro for defining a ble_hrs instance.">BLE_HRS_DEF</a>(m_hrs); <span class="comment">/* HRS instance. */</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* The BLE_HRS_DEF macro above is equivalent to the following pattern:</span></div>
<div class="line"><span class="comment">   ble_hrs_t m_hrs; /* HRS instance. */</span></div>
<div class="line">   NRF_BLE_OBSERVER(m_hrs_ble_observer, <a class="code" href="group__nrf__sdh__ble__config.html#gabb732215afe89dd069ab0776253d4d09" title="Priority with which BLE events are dispatched to the Heart Rate Service.">BLE_HRS_BLE_OBSERVER_PRIO</a>, <a class="code" href="group__ble__hrs.html#ga5d86b39ae7f40223fcb7caaf3978bf70" title="Function for handling the Application&#39;s BLE Stack events.">ble_hrs_on_ble_evt</a>, m_hrs);</div>
<div class="line"> */</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Manually register the application as a BLE observer. */</span></div>
<div class="line">NRF_BLE_OBSERVER(m_app_ble_observer,      <span class="comment">/* Name of the observer. */</span></div>
<div class="line">                 APP_BLE_OBSERVER_PRIO,   <span class="comment">/* Priority of the observer. */</span></div>
<div class="line">                 on_ble_evt,              <span class="comment">/* Handler function. */</span></div>
<div class="line">                 NULL                     <span class="comment">/* Optional parameter to the handler. */</span></div>
<div class="line">                 );</div>
</div><!-- fragment --><p>All examples using the SoftDevice have been updated to reflect these changes. A similar mechanism is in place for ANT examples as well.</p>
<p><em><b>Action:</b> Update your application as shown in the examples.</em></p>
<h2><a class="anchor" id="migration_ble_adv_mod"></a>
Advertising Module (ble_advertising)</h2>
<p>Memory for the advertising module has been moved to the new struct <a class="el" href="structble__advertising__t.html">ble_advertising_t</a>. The struct must be passed as a reference when the module is used. All APIs to the advertising module have been modified to reflect this change.</p>
<ul>
<li><a class="el" href="group__ble__advertising.html#ga76c219a3afcb5cc5f53ec85e434d3104">ble_advertising_on_ble_evt</a></li>
<li><a class="el" href="group__ble__advertising.html#ga878a5f30eac47f2a2b9293ed0528aa01">ble_advertising_restart_without_whitelist</a></li>
<li><a class="el" href="group__ble__advertising.html#ga4c1be1a7b547102c4147e524e6c80925">ble_advertising_whitelist_reply</a></li>
<li><a class="el" href="group__ble__advertising.html#gadf2cc35c97d0d6a75abbc82a6f148ee4">ble_advertising_peer_addr_reply</a></li>
<li><a class="el" href="group__ble__advertising.html#gadf2cc35c97d0d6a75abbc82a6f148ee4">ble_advertising_peer_addr_reply</a></li>
<li><a class="el" href="group__ble__advertising.html#gae2beedbcde9e995276a685a329e5b46b">ble_advertising_start</a></li>
<li><a class="el" href="group__ble__advertising.html#ga3117ef69ce4d31b09be0bb1421e54150">ble_advertising_conn_cfg_tag_set</a></li>
<li><a class="el" href="group__ble__advertising.html#gabbdf62a76d64fc8d5e5b0d183d3c0fa7">ble_advertising_init</a></li>
<li><a class="el" href="group__ble__advertising.html#gafed9a86bdca196bffdeb5f534747fa10">ble_advertising_on_sys_evt</a></li>
</ul>
<p>Example of a change in <code>ble_advertising.h:</code> </p>
<p><b>Old:</b> </p>
<div class="fragment"><div class="line">uint32_t <a class="code" href="group__ble__advertising.html#gae2beedbcde9e995276a685a329e5b46b" title="Function for starting advertising.">ble_advertising_start</a>(<a class="code" href="group__ble__advertising.html#gae4fb26dd401f1fbdf501b935c9f73d2b" title="Advertising modes.">ble_adv_mode_t</a> advertising_mode); </div>
</div><!-- fragment --><p><b>New:</b> </p>
<div class="fragment"><div class="line">uint32_t <a class="code" href="group__ble__advertising.html#gae2beedbcde9e995276a685a329e5b46b" title="Function for starting advertising.">ble_advertising_start</a>(<a class="code" href="structble__advertising__t.html">ble_advertising_t</a> * <span class="keyword">const</span> p_advertising, <a class="code" href="group__ble__advertising.html#gae4fb26dd401f1fbdf501b935c9f73d2b" title="Advertising modes.">ble_adv_mode_t</a> advertising_mode);</div>
</div><!-- fragment --><p><em><b>Action:</b> Declare <a class="el" href="structble__advertising__t.html">ble_advertising_t</a> in your application code. Modify all calls to <code>ble_advertising</code> to take this struct as the first parameter.</em></p>
<h2><a class="anchor" id="migration_ble_adv_init"></a>
ble_advertising_init</h2>
<p>A new struct <a class="el" href="structble__advertising__init__t.html">ble_advertising_init_t</a> is used to initialize the advertising module. This makes the module consistent with other BLE modules. The struct contains the same parameters that are already being passed to <a class="el" href="group__ble__advertising.html#gabbdf62a76d64fc8d5e5b0d183d3c0fa7">ble_advertising_init</a>.</p>
<p><b>Old:</b> </p>
<div class="fragment"><div class="line">uint32_t <a class="code" href="group__ble__advertising.html#gabbdf62a76d64fc8d5e5b0d183d3c0fa7" title="Function for initializing the Advertising Module.">ble_advertising_init</a>(<a class="code" href="structble__advdata__t.html" title="Advertising data structure. This structure contains all options and data needed for encoding and sett...">ble_advdata_t</a> <span class="keyword">const</span> * p_advdata, <a class="code" href="structble__advdata__t.html" title="Advertising data structure. This structure contains all options and data needed for encoding and sett...">ble_advdata_t</a> <span class="keyword">const</span> * p_srdata, <a class="code" href="structble__adv__modes__config__t.html" title="Options for the different advertisement modes.">ble_adv_modes_config_t</a> <span class="keyword">const</span> * p_config, <a class="code" href="group__ble__advertising.html#gaca3142bc7bd042f618b30c1008169fb8" title="BLE advertising event handler type.">ble_adv_evt_handler_t</a> <span class="keyword">const</span> evt_handler, <a class="code" href="group__ble__advertising.html#ga8000d719edd0bfadb54beb1964da860d" title="BLE advertising error handler type.">ble_adv_error_handler_t</a> <span class="keyword">const</span> error_handler);</div>
</div><!-- fragment --><p><b>New:</b> </p>
<div class="fragment"><div class="line">uint32_t <a class="code" href="group__ble__advertising.html#gabbdf62a76d64fc8d5e5b0d183d3c0fa7" title="Function for initializing the Advertising Module.">ble_advertising_init</a>(<a class="code" href="structble__advertising__t.html">ble_advertising_t</a> * <span class="keyword">const</span> p_advertising, <a class="code" href="structble__advertising__init__t.html" title="Initialization parameters for the Advertising Module.">ble_advertising_init_t</a> <span class="keyword">const</span> * <span class="keyword">const</span> p_init);</div>
</div><!-- fragment --><p><em><b>Action:</b> Modify your code so that the old init parameters are now part of the init struct instead.</em></p>
<h2><a class="anchor" id="migration_ble_adv_enc"></a>
Advertising Encoder (ble_advdata)</h2>
<p>For consistency, the name of <code>adv_data_encode()</code> was changed to <a class="el" href="group__ble__sdk__lib__advdata.html#gada09a936711b42daf8bc376421e83251">ble_advdata_encode()</a>. This matches the naming scheme of <code>ble_advdata.c</code> There is no functional change.</p>
<p>Renamed API:</p>
<p><b>Old:</b> <code>adv_data_encode()</code> </p>
<p><b>New:</b> <code><a class="el" href="group__ble__sdk__lib__advdata.html#gada09a936711b42daf8bc376421e83251" title="Function for encoding data in the Advertising and Scan Response data format (AD structures).">ble_advdata_encode()</a></code> </p>
<p><em><b>Action:</b> Update to use the new name.</em></p>
<h2><a class="anchor" id="migration_ble_conn_params"></a>
Connection Parameters Module (ble_conn_params)</h2>
<p>This module has been updated to support multiple concurrent peripheral roles. It will negotiate connection parameters independently on each peripheral link. As a consequence, the API has the following changes:</p>
<ul>
<li>The function <a class="el" href="group__ble__conn__params.html#gacbff87b2c34166d2604d15c74201ea55">ble_conn_params_change_conn_params()</a> now takes an additional parameter, <code>conn_handle</code>, which specifies for which link to update the connection parameters.</li>
<li>The event structure now contains an additional member, <code>conn_handle</code>, which specifies to which link the event pertains.</li>
</ul>
<p>In addition, the following minor API changes have been made for consistency and correctness:</p>
<ul>
<li>The return code type has been changed from <code>uint32_t</code> to <code>ret_code_t</code>, requiring the <code>sdk_errors.h</code> header file.</li>
<li>The parameter of <code>ble_conn_params_on_ble_evt</code> has been made <code>const</code>.</li>
<li>The existing parameter of <a class="el" href="group__ble__conn__params.html#gacbff87b2c34166d2604d15c74201ea55">ble_conn_params_change_conn_params()</a> has been renamed from <code>new_params</code> to <code>p_new_params</code>.</li>
</ul>
<h1><a class="anchor" id="migration_fds"></a>
Flash Data Storage (FDS)</h1>
<h2><a class="anchor" id="migration_fds_chunks"></a>
FDS record chunks removed</h2>
<dl class="section note"><dt>Note</dt><dd>This feature is distinct from the 'chunks' in nrf_fstorage.</dd></dl>
<p><b>Old API</b>: </p>
<div class="fragment"><div class="line"><a class="code" href="structfds__record__t.html" title="A record to be written to flash.">fds_record_t</a> rec;</div>
<div class="line"><a class="code" href="structfds__record__desc__t.html" title="The record descriptor structure that is used to manipulate records.">fds_record_desc_t</a> rec_desc;</div>
<div class="line">fds_record_chunk_t rec_chunk;</div>
<div class="line"><span class="comment">// Prepare chunk.</span></div>
<div class="line">rec_chunk.p_data = p_data;</div>
<div class="line">rec_chunk.length_words = length_words;</div>
<div class="line"><span class="comment">// Prepare the record to be stored in flash.</span></div>
<div class="line">rec.<a class="code" href="structfds__record__t.html#a2417128bc75dd4bc49cdfb8f768200a1" title="The ID of the file that the record belongs to.">file_id</a> = file_id;</div>
<div class="line">rec.<a class="code" href="structfds__record__t.html#a162cb23b9b81fea13ef0fbec7014fc7c" title="The record key.">key</a> = key;</div>
<div class="line">rec.data.p_chunks = &amp;rec_chunk;</div>
<div class="line">rec.data.num_chunks = 1;</div>
<div class="line"><a class="code" href="group__fds.html#ga0114083241dc287c7145fe113c9adc2c" title="Function for writing a record to flash.">fds_record_write</a>(&amp;rec_desc, &amp;rec);</div>
</div><!-- fragment --><p><b>New API</b>: </p>
<div class="fragment"><div class="line"><a class="code" href="structfds__record__t.html" title="A record to be written to flash.">fds_record_t</a> rec;</div>
<div class="line"><a class="code" href="structfds__record__desc__t.html" title="The record descriptor structure that is used to manipulate records.">fds_record_desc_t</a> rec_desc;</div>
<div class="line"><span class="comment">// Prepare the record to be stored in flash.</span></div>
<div class="line">rec.<a class="code" href="structfds__record__t.html#a2417128bc75dd4bc49cdfb8f768200a1" title="The ID of the file that the record belongs to.">file_id</a> = file_id;</div>
<div class="line">rec.<a class="code" href="structfds__record__t.html#a162cb23b9b81fea13ef0fbec7014fc7c" title="The record key.">key</a> = key;</div>
<div class="line">rec.data.p_data = p_data;</div>
<div class="line">rec.data.length_words = length_words;</div>
<div class="line"><a class="code" href="group__fds.html#ga0114083241dc287c7145fe113c9adc2c" title="Function for writing a record to flash.">fds_record_write</a>(&amp;rec_desc, &amp;rec);</div>
</div><!-- fragment --><p>The <code>FDS_CHUNK_QUEUE_SIZE</code> configuration option was removed.</p>
<h2><a class="anchor" id="migration_fds_header"></a>
fds_header_t</h2>
<p>The <code>fds_ic_t</code> and <code>fds_tl_t</code> structs have been removed. The <code><a class="el" href="structfds__header__t.html" title="The record metadata as stored in flash.">fds_header_t</a></code> struct has changed. </p>
<dl class="section note"><dt>Note</dt><dd>This change does not modify the FDS record format in flash.</dd></dl>
<p><b>Old API</b>: </p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">    uint16_t record_key;</div>
<div class="line">    uint16_t length_words;</div>
<div class="line">} fds_tl_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">    uint16_t file_id;</div>
<div class="line">    uint16_t crc16;</div>
<div class="line">} fds_ic_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">    fds_tl_t tl;</div>
<div class="line">    fds_ic_t ic;</div>
<div class="line">    uint32_t record_id;</div>
<div class="line">} <a class="code" href="structfds__header__t.html" title="The record metadata as stored in flash.">fds_header_t</a>;</div>
</div><!-- fragment --><p><b>New API</b>: </p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">    uint16_t record_key;</div>
<div class="line">    uint16_t length_words;</div>
<div class="line">    uint16_t file_id;</div>
<div class="line">    uint16_t crc16;</div>
<div class="line">    uint32_t record_id;</div>
<div class="line">} <a class="code" href="structfds__header__t.html" title="The record metadata as stored in flash.">fds_header_t</a>;</div>
</div><!-- fragment --><h2><a class="anchor" id="migration_fds_config"></a>
CRC configuration options</h2>
<p>CRC configuration options have changed.</p>
<ul>
<li><code>FDS_CRC_ENABLED</code> has been split into:<ol type="1">
<li><code>FDS_CRC_CHECK_ON_READ:</code> If enabled, perform a CRC check upon opening a record.</li>
<li><code>FDS_CRC_CHECK_ON_WRITE:</code> If enabled, perform a CRC check upon writing a record.</li>
</ol>
</li>
<li><code>fds_crc_check_on_write(bool)</code> has been removed.</li>
</ul>
<h1><a class="anchor" id="migration_fstorage"></a>
fstorage</h1>
<p>The following fstorage APIs have been changed:</p>
<table class="doxtable">
<tr>
<th>Old </th><th>New </th><th>Remarks </th></tr>
<tr>
<td>fs_init </td><td><a class="el" href="group__nrf__fstorage.html#gab79d5600c602c2aa0ac2ddd4e61ed449">nrf_fstorage_init</a> </td><td></td></tr>
<tr>
<td>fs_store </td><td><a class="el" href="group__nrf__fstorage.html#ga5a37147f85e54eb049d3cad8bf59c807">nrf_fstorage_write</a> </td><td>Length parameters are expressed in bytes instead of words. </td></tr>
<tr>
<td>fs_erase </td><td><a class="el" href="group__nrf__fstorage.html#ga23f2e5019d0e6cbf6e45a51713dd5b1a">nrf_fstorage_erase</a> </td><td></td></tr>
<tr>
<td></td><td><a class="el" href="group__nrf__fstorage.html#gaebb4176a9aa38b3398e446efa0592939">nrf_fstorage_read</a> </td><td>New API. </td></tr>
<tr>
<td>fs_queued_op_count_get </td><td><a class="el" href="group__nrf__fstorage.html#ga269ea68580fd2c072b602166cdfc16f8">nrf_fstorage_is_busy</a> </td><td></td></tr>
</table>
<p>The following fstorage macros have been changed:</p>
<table class="doxtable">
<tr>
<th>Old </th><th>New </th><th>Remarks </th></tr>
<tr>
<td>FS_REGISTER_CFG </td><td><a class="el" href="group__nrf__fstorage.html#ga0b8f6204f5f7feffac0ffba8bdc159ff">NRF_FSTORAGE_DEF</a> </td><td></td></tr>
<tr>
<td>FS_OP_QUEUE_SIZE </td><td><a class="el" href="group__nrf__fstorage__config.html#ga252e29d6763cd2562e44d0167f26f2a6">NRF_FSTORAGE_SD_QUEUE_SIZE</a> </td><td></td></tr>
<tr>
<td>FS_OP_MAX_RETRIES </td><td><a class="el" href="group__nrf__fstorage__config.html#ga9dae667c08aba31a7afd82ff627bdc09">NRF_FSTORAGE_SD_MAX_RETRIES</a> </td><td></td></tr>
<tr>
<td>FS_MAX_WRITE_SIZE_WORDS</td><td><a class="el" href="group__nrf__fstorage__config.html#gad6e1d9ce4bc885ad5585f776e831b1dc">NRF_FSTORAGE_SD_MAX_WRITE_SIZE</a> </td><td>Now expressed in bytes. </td></tr>
</table>
<p>The following fstorage data types have been changed:</p>
<table class="doxtable">
<tr>
<th>Old </th><th>New </th><th>Remarks  </th></tr>
<tr>
<td>fs_config_t </td><td><a class="el" href="structnrf__fstorage__t.html">nrf_fstorage_t</a> </td><td><ul>
<li>
p_start_addr -&gt; start_addr (must be manually set) </li>
<li>
p_end_addr -&gt; end_addr (must be manually set) </li>
<li>
priority -&gt; removed </li>
<li>
callback -&gt; evt_handler </li>
</ul>
</td></tr>
<tr>
<td>fs_evt_t </td><td><a class="el" href="structnrf__fstorage__evt__t.html">nrf_fstorage_evt_t</a> </td><td>Structure changed slightly.  </td></tr>
<tr>
<td>fs_evt_id_t </td><td><a class="el" href="group__nrf__fstorage.html#gaaf3afe024c1f96a15b21f1241c860d2d">nrf_fstorage_evt_id_t</a> </td><td>See Events.  </td></tr>
<tr>
<td>fs_cb_t </td><td><a class="el" href="group__nrf__fstorage.html#ga075b1d962440dadf750afaaf581ca943">nrf_fstorage_evt_handler_t</a> </td><td>Signature changed slightly.  </td></tr>
</table>
<p>The following fstorage events have been changed:</p>
<table class="doxtable">
<tr>
<th>Old </th><th>New</th></tr>
<tr>
<td>FS_EVT_STORE </td><td><a class="el" href="group__nrf__fstorage.html#ggaaf3afe024c1f96a15b21f1241c860d2da5e5fbe9199debbb6ace7aeaf777733d2">NRF_FSTORAGE_EVT_WRITE_RESULT</a> </td></tr>
<tr>
<td>FS_EVT_ERASE </td><td><a class="el" href="group__nrf__fstorage.html#ggaaf3afe024c1f96a15b21f1241c860d2da97fda985ee0e6f94971c354ccf6b3177">NRF_FSTORAGE_EVT_ERASE_RESULT</a> </td></tr>
</table>
<p>The following fstorage return values have been changed:</p>
<table class="doxtable">
<tr>
<th>Old </th><th>New</th></tr>
<tr>
<td>FS_SUCCESS </td><td><a class="elRef" doxygen="tag_s212_offline.tag:../s212/" href="../s212/group__nrf__error.html#ga7e6367efeaac363d8cf024940b4ec123">NRF_SUCCESS</a> </td></tr>
<tr>
<td>FS_ERR_NOT_INITIALIZED </td><td><a class="elRef" doxygen="tag_s212_offline.tag:../s212/" href="../s212/group__nrf__error.html#gaf0aff2ba7864b34a36b4a96986e1851e">NRF_ERROR_INVALID_STATE</a> </td></tr>
<tr>
<td>FS_ERR_NULL_ARG </td><td><a class="elRef" doxygen="tag_s212_offline.tag:../s212/" href="../s212/group__nrf__error.html#gaf6e08e45224ec612e6c95660eb1bcfa0">NRF_ERROR_NULL</a> </td></tr>
<tr>
<td>FS_ERR_INVALID_ARG </td><td><a class="elRef" doxygen="tag_s212_offline.tag:../s212/" href="../s212/group__nrf__error.html#ga59fe2a8fe184005aefa0835c7ff400fd">NRF_ERROR_INVALID_LENGTH</a> </td></tr>
<tr>
<td>FS_ERR_INVALID_CFG </td><td>Removed </td></tr>
<tr>
<td>FS_ERR_INVALID_ADDR </td><td><a class="elRef" doxygen="tag_s212_offline.tag:../s212/" href="../s212/group__nrf__error.html#gabc562e4ddfe2f427666a3acdd0b469a3">NRF_ERROR_INVALID_ADDR</a> </td></tr>
<tr>
<td>FS_ERR_UNALIGNED_ADDR </td><td><a class="elRef" doxygen="tag_s212_offline.tag:../s212/" href="../s212/group__nrf__error.html#gabc562e4ddfe2f427666a3acdd0b469a3">NRF_ERROR_INVALID_ADDR</a> </td></tr>
<tr>
<td>FS_ERR_QUEUE_FULL </td><td><a class="elRef" doxygen="tag_s212_offline.tag:../s212/" href="../s212/group__nrf__error.html#ga7ef4d466b79b31c6325f8b7af5d4f75f">NRF_ERROR_NO_MEM</a> </td></tr>
<tr>
<td>FS_ERR_NOT_SUPPORTED </td><td><a class="elRef" doxygen="tag_s212_offline.tag:../s212/" href="../s212/group__nrf__error.html#gaacf52836cc3860c5ffd4e129f725f138">NRF_ERROR_NOT_SUPPORTED</a> </td></tr>
<tr>
<td>FS_ERR_INTERNAL </td><td><a class="elRef" doxygen="tag_s212_offline.tag:../s212/" href="../s212/group__nrf__error.html#gadf8b0c33ea15352808e5ac7f69c2be8a">NRF_ERROR_INTERNAL</a> </td></tr>
</table>
<h1><a class="anchor" id="migration_ble_config"></a>
Configuration of the BLE stack</h1>
<p>Examples now configure the stack using the <code>nrf_sdh</code> function <a class="el" href="group__nrf__sdh__ble.html#ga20d99b6d73ca06cb2078d140f9b380c1">nrf_sdh_ble_default_cfg_set()</a>. The function configures the BLE stack based on the paramenters in the <code>nrf_sdh_ble</code> group from the <code>sdk_config</code> file. Those parameters are also used by other libraries in the SDK, such as <code>ble_conn_params</code> and <code>nrf_ble_gatt</code>. Update them as necessary in your projects.</p>
<h1><a class="anchor" id="migration_libs"></a>
Libraries</h1>
<p>The API of the following libraries has been changed.</p>
<h2><a class="anchor" id="migration_libs_nrf_cli"></a>
nrf_cli</h2>
<p>The command line interface has been significantly reworked and is currently in experimental state. Familiarize yourself with new documentation and example to see how to use the improved CLI module. See <a class="el" href="lib_cli.html">Experimental: Command Line Interface library</a> and <a class="el" href="cli_example.html">Command Line Interface (CLI) Example</a>.</p>
<h2><a class="anchor" id="migration_libs_nrf_log"></a>
nrf_log</h2>
<ul>
<li>Changes in logger configuration for a module.<ul>
<li>The <code>NRF_LOG_MODULE_NAME</code> define must contain the module name without quotation marks.</li>
<li>Each logger module must be registered using the <a class="el" href="group__nrf__log.html#ga76621628447823a4d868d57f6049eef1">NRF_LOG_MODULE_REGISTER()</a> macro (defined in <code>nrf_log.h</code>).</li>
</ul>
</li>
</ul>
<p>Example: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define NRF_LOG_MODULE_NAME &quot;spi&quot;</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#include &quot;nrf_log.h&quot;</span></div>
</div><!-- fragment --><p>The above code must be changed to: </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define NRF_LOG_MODULE_NAME spi </span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#include &quot;nrf_log.h&quot;</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="group__nrf__log.html#ga76621628447823a4d868d57f6049eef1" title="Macro for registering an independent module.">NRF_LOG_MODULE_REGISTER</a>();</div>
</div><!-- fragment --><ul>
<li>A new line is appended to every log entry.</li>
</ul>
<p><code>NRF_LOG_INFO</code>("my log\r\n") must be changed to <code>NRF_LOG_INFO</code>("my log").</p>
<ul>
<li><a class="el" href="group__nrf__log__ctrl.html#gaa5666ad1f5314e15f5e591f135f38503">NRF_LOG_INIT()</a> initializes only the logger frontend.</li>
</ul>
<p>In order to get logs out, a backend must be added. You can add a backend in multiple ways.</p>
<ul>
<li>With initialized backend, call <a class="el" href="group__nrf__log__ctrl.html#ga341d3593b6b5d33434e14a9a1b526efd">nrf_log_backend_add()</a>.</li>
<li>Use the <code>nrf_log_default_backends</code> module. Call the <a class="el" href="group__nrf__log__default__backends.html#gac2e95ef0e3a46df6d129589accabc9e8">NRF_LOG_DEFAULT_BACKENDS_INIT()</a> macro after <a class="el" href="group__nrf__log__ctrl.html#gaa5666ad1f5314e15f5e591f135f38503">NRF_LOG_INIT()</a>. Make sure that at least one of default backends is enabled in <code>sdk_config.h</code> (<code>NRF_LOG_BACKEND_RTT_ENABLED</code> or <code>NRF_LOG_BACKEND_UART_ENABLED</code>).</li>
<li>Use an instance of <code><a class="el" href="structnrf__cli.html" title="CLI instance internals.">nrf_cli</a></code> as the logger backend. See one of the examples (<code>examples/ble_peripheral/ble_app_cli</code> or <code>examples/peripheral/cli</code>)</li>
</ul>
<ul>
<li>Configuration changes</li>
</ul>
<p>NRF_LOG_DEFERRED_BUFSIZE renamed to <a class="el" href="group__nrf__log__config.html#ga22afeab30e44d3279b09d59b4e690891">NRF_LOG_BUFSIZE</a>. Added options:</p>
<ul>
<li><a class="el" href="group__nrf__log__config.html#gaf74fbd7ab681853e83f9b18029208e8e">NRF_LOG_ALLOW_OVERFLOW</a></li>
<li><a class="el" href="group__nrf__log__config.html#ga54de99b533b75ecce023876d24c05e98">NRF_LOG_FILTERS_ENABLED</a></li>
<li><a class="el" href="group__nrf__log__config.html#gab3fdd3621551cb14536abc09d08fc345">NRF_LOG_CLI_CMDS</a></li>
</ul>
<h2><a class="anchor" id="migration_libs_nrf_pwr_mgmt"></a>
nrf_pwr_mgmt</h2>
<p>Usage of the <a class="el" href="group__nrf__pwr__mgmt.html#ga4adfb2cc1fcbfe94a0fb1453b0cf30ec">NRF_PWR_MGMT_HANDLER_REGISTER</a> macro has been modified. </p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> shutdown_handler(<a class="code" href="group__nrf__pwr__mgmt.html#gab81cb0d4c56fd0317094f6327ca2a9a4" title="Shutdown event types.">nrf_pwr_mgmt_evt_t</a> event)</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"><a class="code" href="group__nrf__pwr__mgmt.html#ga4adfb2cc1fcbfe94a0fb1453b0cf30ec" title="Macro for registering a shutdown handler. Modules that want to get events from this module must regis...">NRF_PWR_MGMT_HANDLER_REGISTER</a>(m_unused_variable, 0) = shutdown_handler;</div>
</div><!-- fragment --><p>The above code must be replaced with: </p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> shutdown_handler(<a class="code" href="group__nrf__pwr__mgmt.html#gab81cb0d4c56fd0317094f6327ca2a9a4" title="Shutdown event types.">nrf_pwr_mgmt_evt_t</a> event)</div>
<div class="line">{</div>
<div class="line">}</div>
<div class="line"><a class="code" href="group__nrf__pwr__mgmt.html#ga4adfb2cc1fcbfe94a0fb1453b0cf30ec" title="Macro for registering a shutdown handler. Modules that want to get events from this module must regis...">NRF_PWR_MGMT_HANDLER_REGISTER</a>(shutdown_handler, 0);</div>
</div><!-- fragment --><h2><a class="anchor" id="migration_libs_atomic_fifo"></a>
Atomic FIFO</h2>
<ul>
<li>Module and file names have changed.</li>
</ul>
<table class="doxtable">
<tr>
<th>Old name </th><th>New name </th><th>Remarks </th></tr>
<tr>
<td>app_atfifo </td><td>nrf_atfifo </td><td>Module renamed. </td></tr>
<tr>
<td>app_atfifo.h </td><td>nrf_atfifo.h </td><td></td></tr>
<tr>
<td>app_atfifo.c </td><td>nrf_atfifo.c </td><td></td></tr>
<tr>
<td>app_atfifo_ </td><td>nrf_atfifo_ </td><td>Renamed the prefix of all functions, variables, and types. </td></tr>
<tr>
<td>APP_ATFIFO_ </td><td>NRF_ATFIFO_ </td><td>Renamed the prefix of all functions, variables, and types. </td></tr>
</table>
<ul>
<li>The following functions have changed.</li>
</ul>
<table class="doxtable">
<tr>
<th>Old name </th><th>New name </th><th>Remarks </th></tr>
<tr>
<td>app_atfifo_put </td><td>nrf_atfifo_alloc_put </td><td></td></tr>
<tr>
<td>app_atfifo_get </td><td>nrf_atfifo_get_free </td><td></td></tr>
<tr>
<td>app_atfifo_wopen </td><td>nrf_atfifo_item_alloc </td><td>The last argument (size) has been removed. Function always allocates the size for a single element. </td></tr>
<tr>
<td>app_atfifo_wcommit </td><td>nrf_atfifo_item_put </td><td></td></tr>
<tr>
<td>app_atfifo_ropen </td><td>nrf_atfifo_item_get </td><td>The last argument (size) has been removed. Function always assumes that the element has the correct size of the one element. </td></tr>
<tr>
<td>app_atfifo_rflush </td><td>nrf_atfifo_item_free </td><td></td></tr>
</table>
<ul>
<li>The following data types have changed.</li>
</ul>
<table class="doxtable">
<tr>
<th>Old name </th><th>New name</th></tr>
<tr>
<td>app_atfifo_wcontext_t </td><td>nrf_atfifo_item_put_t </td></tr>
<tr>
<td>app_atfifo_rcontext_t </td><td>nrf_atfifo_item_get_t </td></tr>
</table>
<h1><a class="anchor" id="migration_nfc"></a>
NFC</h1>
<h2><a class="anchor" id="migration_nfc_ndef_record"></a>
NDEF record and message descriptors</h2>
<p>NDEF record and message descriptors are declared as automatic variables, which implies that the NDEF message encoding must be done in the same variable scope. Previously, all record and message descriptors were declared static.</p>
<h2><a class="anchor" id="migration_nfc_pairing_lib"></a>
NFC BLE pairing library</h2>
<p>Due to updates in the advertising module, the function <a class="el" href="group__nfc__ble__pair__lib.html#ga65f761477f7fdaf9655d279f6fc6b41c">nfc_ble_pair_init()</a> takes a pointer to the advertising module data <code>p_advertising</code>.</p>
<p><b>Old</b> </p>
<div class="fragment"><div class="line"><a class="code" href="group__sdk__error.html#gaf6c20fb483036617204f12e99e0b997b" title="API Result.">ret_code_t</a> <a class="code" href="group__nfc__ble__pair__lib.html#ga65f761477f7fdaf9655d279f6fc6b41c" title="Initializes NFC tag data and turns on tag emulation.">nfc_ble_pair_init</a>(<a class="code" href="group__nfc__ble__pair__lib.html#gac2b22ae41bddc6148b2ee82f4383837e" title="NFC pairing types.">nfc_pairing_mode_t</a> mode);</div>
</div><!-- fragment --><p><b>New</b> </p>
<div class="fragment"><div class="line"><a class="code" href="group__sdk__error.html#gaf6c20fb483036617204f12e99e0b997b" title="API Result.">ret_code_t</a> <a class="code" href="group__nfc__ble__pair__lib.html#ga65f761477f7fdaf9655d279f6fc6b41c" title="Initializes NFC tag data and turns on tag emulation.">nfc_ble_pair_init</a>(ble_advetising_t * p_advertising, <a class="code" href="group__nfc__ble__pair__lib.html#gac2b22ae41bddc6148b2ee82f4383837e" title="NFC pairing types.">nfc_pairing_mode_t</a> mode);</div>
</div><!-- fragment --><p><em><b>Action:</b> Modify your code by adding the pointer to the advertising module data as a parameter to <a class="el" href="group__nfc__ble__pair__lib.html#ga65f761477f7fdaf9655d279f6fc6b41c">nfc_ble_pair_init()</a>.</em></p>
<h1><a class="anchor" id="migration_dfu"></a>
DFU</h1>
<p>The BLE Secure Bootloader has added configurations for requiring bonds and for unbonded switching between itself and the application. Any implementation must choose which one of these configurations to enable. No changes to the example implementation should be required, but this choice should be made in the configuration of both the <a class="el" href="ble_sdk_app_buttonless_dfu.html">Buttonless DFU Template Application</a> and the <a class="el" href="ble_sdk_app_dfu_bootloader.html">BLE Secure DFU Bootloader</a>.</p>
<p>To enable or disable the support of bonds in the Buttonless DFU Template Application, modify these configuration parameters in the <code>sdk_config</code> file: </p>
<div class="fragment"><div class="line">sdk_config.h</div>
<div class="line"><span class="preprocessor">#ifndef NRF_DFU_BLE_BUTTONLESS_SUPPORTS_BONDS</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define NRF_DFU_BLE_BUTTONLESS_SUPPORTS_BONDS 1</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><p>To enable or disable the support of bonds in the Secure DFU Bootloader, modify these configuration parameters in the <code>sdk_config</code> file: </p>
<div class="fragment"><div class="line">sdk_config.h</div>
<div class="line"><span class="preprocessor">#ifndef NRF_DFU_BLE_REQUIRES_BONDS</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define NRF_DFU_BLE_REQUIRES_BONDS 1</span></div>
<div class="line"><span class="preprocessor">#endif#endif</span></div>
</div><!-- fragment --><p><em><b>Action:</b> Case 1: Implementations utilizing a button to switch to DFU must be updated to utilize either bonded or unbonded switching.</em></p>
<p><em><b>Action:</b> Case 2: With buttonless DFU, the changes are significant. It is recommended not to port the example but to just use the new implementation.</em></p>
<h2><a class="anchor" id="migration_dfu_timer"></a>
Inactivity timeout timer</h2>
<p>Secure DFU has an added inactivity timeout timer that will automatically reset the device in case there are no new incoming command requests received by the bootloader within the configured timeout limit. The inactivity timeout can be adjusted from the default time of 2 minutes by modifying NRF_DFU_INACTIVITY_TIMEOUT_MS in the <code>sdk_config</code> file. </p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef NRF_DFU_INACTIVITY_TIMEOUT_MS</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define NRF_DFU_INACTIVITY_TIMEOUT_MS 120000</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><h2><a class="anchor" id="migration_dfu_api"></a>
DFU API changes</h2>
<p>The following defines have been renamed.</p>
<table class="doxtable">
<tr>
<th>Old name </th><th>New name</th></tr>
<tr>
<td>BLE_DFU_EVT_ENTERING_BOOTLOADER </td><td><a class="el" href="group__ble__dfu.html#gga6724de6a7e19cdc79dbf403f7b49e222a3d8678091e0b74faa6697a3895081601">BLE_DFU_EVT_BOOTLOADER_ENTER</a> </td></tr>
<tr>
<td>DFU_RSP_RESERVED </td><td><a class="el" href="group__ble__dfu.html#ggaee02589c1d3040ad269a6f37f6645937a1314b6248e7f40f872583e042f0e2dc6">DFU_RSP_INVALID</a> </td></tr>
</table>
<p>The following defines have been removed.</p>
<ul>
<li><code>BLE_DFU_EVT_INDICATION_ENABLED</code> </li>
<li><code>BLE_DFU_EVT_INDICATION_DISABLED</code> </li>
</ul>
<p>The following data types have been renamed:</p>
<table class="doxtable">
<tr>
<th>Old name </th><th>New name </th><th>Remarks </th></tr>
<tr>
<td>ble_dfu_evt_type_t </td><td><a class="el" href="group__ble__dfu.html#ga6724de6a7e19cdc79dbf403f7b49e222">ble_dfu_buttonless_evt_type_t</a> </td><td></td></tr>
<tr>
<td>ble_dfu_rsp_code_t </td><td><a class="el" href="group__ble__dfu.html#gaee02589c1d3040ad269a6f37f6645937">ble_dfu_buttonless_rsp_code_t</a> </td><td></td></tr>
<tr>
<td>ble_dfu_init_t </td><td><a class="el" href="structble__dfu__buttonless__init__t.html">ble_dfu_buttonless_init_t</a> </td><td></td></tr>
<tr>
<td>ble_dfu_evt_handler_t </td><td><a class="el" href="group__ble__dfu.html#gaaeb936f1f1ba6c21ebd6d32fe517e430">ble_dfu_buttonless_evt_handler_t</a> </td><td>Parameters have changed. </td></tr>
</table>
<p>The following functions have been renamed.</p>
<table class="doxtable">
<tr>
<th>Old name </th><th>New name </th><th>Remarks </th></tr>
<tr>
<td>ble_dfu_init </td><td><a class="el" href="group__ble__dfu.html#gaaec2969dda3078dfec8d29a8cd9dda10">ble_dfu_buttonless_init</a> </td><td>Parameters have changed. </td></tr>
<tr>
<td>ble_dfu_on_ble_evt </td><td><a class="el" href="group__ble__dfu.html#gafba513f1b11dc518065b69216a533633">ble_dfu_buttonless_on_ble_evt</a> </td><td>Parameters have changed. </td></tr>
</table>
<p>Struct <code>ble_dfu_s</code> has been renamed to <a class="el" href="structble__dfu__buttonless__t.html">ble_dfu_buttonless_t</a>.</p>
<p>The type of <code>evt_handler</code> has been changed from <code>ble_dfu_evt_handler_t</code> to <code>ble_dfu_buttonless_evt_handler_t</code> and the members <code>ctrl_point_security_req_write_perm</code> and <code>ctrl_point_security_req_cccd_write_perm</code> have been deleted.</p>
<h1><a class="anchor" id="migration_usb"></a>
USB</h1>
<h2><a class="anchor" id="migration_usb_events"></a>
USBD START and STOP events renamed</h2>
<table class="doxtable">
<tr>
<th>Old name </th><th>New name</th></tr>
<tr>
<td>APP_USBD_EVT_START </td><td><a class="el" href="group__app__usbd__types.html#ggae307a374b0c1a5fa6b9dc07fa517e331a207e0d15ef3951b9a647d3ab41703908">APP_USBD_EVT_STARTED</a> </td></tr>
<tr>
<td>APP_USBD_EVT_STOP </td><td><a class="el" href="group__app__usbd__types.html#ggae307a374b0c1a5fa6b9dc07fa517e331afbd9412ac094f05e4a23e99ce5e8ec80">APP_USBD_EVT_STOPPED</a> </td></tr>
</table>
<h2><a class="anchor" id="migration_usb_main_loop"></a>
Processing of high level events in the main loop</h2>
<p>APP USBD now processes high level events in the main loop. Processing of high level interrupts on thread level minimizes the time the library spends in interrupt context.</p>
<p><em><b>Action:</b> Option 1: Set APP_USBD_EVENT_QUEUE_ENABLE to false to let all the high level interrupts to be processed in interrupt context.</em></p>
<p><em><b>Action:</b> Option 2: Call <a class="el" href="group__app__usbd.html#gadaa7b1f5326fb702c363bac1b78d3e92">app_usbd_event_queue_process()</a> in a loop on the thread context. Update your USB configuration structure. For details, see <a class="el" href="structapp__usbd__config__t.html">app_usbd_config_t</a>.</em></p>
<h2><a class="anchor" id="migration_usb_audio"></a>
USB audio class API rebuilt</h2>
<p>The USB audio API was rebuilt to give the user more control over the timing when new data should be processed. Now, the user does not set the tx and rx buffers inside the library, but must call <a class="el" href="group__app__usbd__audio.html#ga353b37b2827ccd9fe9cce1da2bdfef87">app_usbd_audio_class_rx_start</a> and <a class="el" href="group__app__usbd__audio.html#ga8762ef5b5bd79785593696ee1729e19d">app_usbd_audio_class_tx_start</a> to transfer the data. These functions may be called anytime between SOF events. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="topicfooter">
<a href="mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback" id="maillink">Documentation feedback</a> | <a href="https://devzone.nordicsemi.com/questions/" target="_blank">Developer Zone</a> | <a href="http://response.nordicsemi.com/subscribe-to-our-newsletters" target="_blank">Subscribe</a> | Updated <span id="date"/>
<script>
var date = new Date("Thu Aug 3 2017" + " UTC");
document.getElementById("date").innerHTML = date.toJSON().slice(0, 10);
var url=window.location.href.split("?")[0];
var filename=url.substring(url.lastIndexOf('/')+1);
document.getElementById("maillink").href = "mailto:docfeedback@nordicsemi.no?subject=Documentation%20feedback"+decodeURIComponent("%26")+"body=File%20name%3A%20"+encodeURIComponent(filename);
</script>
</div>
</body>
</html>
